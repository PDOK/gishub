<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>GisHub, Your </title>

    <link rel="stylesheet" type="text/css" href="semantic/dist/semantic.min.css">
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">
    <script
            src="https://code.jquery.com/jquery-3.1.1.min.js"
            integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
            crossorigin="anonymous"></script>
    <script src="semantic/dist/semantic.min.js"></script>
    <link rel="stylesheet" href="https://openlayers.org/en/v4.6.4/css/ol.css" type="text/css">
    <style>
      .map {
        height: 400px;
        width: 100%;
      }
    </style>
    <script src="https://openlayers.org/en/v4.6.4/build/ol.js" type="text/javascript"></script>
</head>

<body>
    <div class="ui equal width aligned padded grid">
        <div class="row">
            <div class="ten wide centered column main">
                <div class="container">
                    <div class="ui segment">
                        <h2 class="ui dividing header">
                            <i class="settings icon"></i>
                            <div class="content">
                                Geo Formaten
                                <div class="sub header">Wat is een geo object en hoe kan je hiermee werken?</div>
                            </div>
                        </h2>
                        <p>
                            Hier komt een beschrijving die nog gevuld moet worden
                        </p>
                        <div class="ui pointing secondary menu">
                            <a class="item" data-tab="first">Screencast</a>
                            <a class="item" data-tab="second">Content</a>
                            <a class="item active" data-tab="third">Activity</a>
                        </div>

                        <h2 class="ui dividing header">
                            <i class="settings icon"></i>
                            <div class="content">
                                Opdracht: Hoe werken deze objecten
                            </div>
                        </h2>
                        <div class="content container">
                            Hier komt je content
                        </div>
                    </div>
                </div>
            </div>
            <div class="four wide column black menu">
                <h2 class="ui header">
                    <img src="assets/images/layers_icon-512.png">
                    <div class="content geo">
                        GisHub
                    </div>
                </h2>
                <div class="ui inverted segment">
                    <div class="ui inverted relaxed divided list">
                        <div class="item">
                            <i class="bordered left check circle outline big green icon"></i>
                            <div class="content">
                                <div class="header">
                                    Geo objecten
                                </div>
                                <div class="description">Welke geo objecten zijn er?</div>
                            </div>
                            <i class="bordered angle left big icon top aligned" style="text-align: right;"></i>
                        </div>
                        <div class="item dropdown-menu">
                            <i class="bordered left circle outline big white icon"></i>
                            <div class="content">
                                <div class="header">
                                    Geo formaten
                                </div>
                                <div class="description">Welke geo formaten zijn er?</div>
                                <div class="item dropdown-submenu">
                                    <div class="content">
                                        <div class="description">
                                            <div class="ui middle aligned bulleted selection list">
                                                <div class="item">
                                                    <div class="content">
                                                        <div class="header">WKT</div>
                                                    </div>
                                                </div>
                                                <div class="item">
                                                    <div class="content">
                                                        <div class="header">GML</div>
                                                    </div>
                                                </div>
                                                <div class="item">
                                                    <div class="content">
                                                        <div class="header">Shape</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <i class="bordered right angle down big icon top aligned" style="text-align: right;"></i>
                        </div>
                        <div class="item">
                            <i class="bordered left circle outline big white icon"></i>
                            <div class="content">
                                <div class="header">
                                    Geo webservices
                                </div>
                                <div class="description">Welke geo webservices zijn er?</div>
                            </div>
                            <i class="bordered angle left big icon top aligned" style="text-align: right;"></i>
                        </div>
                        <div class="item">
                            <i class="bordered left circle outline big white icon"></i>
                            <div class="content">
                                <div class="header">
                                    Geo tools
                                </div>
                                <div class="description">Welke geo tools zijn er?</div>
                            </div>
                            <i class="bordered angle left big icon top aligned" style="text-align: right;"></i>
                        </div>
                        <div class="item">
                            <i class="bordered left circle outline big white icon"></i>
                            <div class="content">
                                <div class="header">
                                    Tiles
                                </div>
                                <div class="description">Hoe werkt een tiles berekening?</div>
                            </div>
                            <i class="bordered angle left big icon top aligned" style="text-align: right;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
      var raster = new ol.layer.Tile({
        source: new ol.source.OSM()
      });

      var source = new ol.source.Vector();
      var vector = new ol.layer.Vector({
        source: source,
        style: new ol.style.Style({
          fill: new ol.style.Fill({
            color: 'rgba(255, 255, 255, 0.2)'
          }),
          stroke: new ol.style.Stroke({
            color: '#ffcc33',
            width: 2
          }),
          image: new ol.style.Circle({
            radius: 7,
            fill: new ol.style.Fill({
              color: '#ffcc33'
            })
          })
        })
      });

      var map = new ol.Map({
        layers: [raster, vector],
        target: 'map',
        view: new ol.View({
          center: [1000000, 7200000],
          zoom: 4
        })
      });

	  var modifiedFeatures= new Array()
      var modify = new ol.interaction.Modify({source: source});
      map.addInteraction(modify);

	  modify.on('modifyend', function(e){
	   var features = e.features.getArray();
		console.log(features.length);
		for (var i = 0; i < features.length; i++) {
			var rev = features[i].getRevision();
			if (rev > 1) {
				console.log("feature with revision:" + rev + " has been modified");
				modifiedFeatures.push(features[i]);
			}
		}
		fill(modifiedFeatures[0])
		modifiedFeatures = new Array()
	  })

      var draw, snap; // global so we can remove them later
      var typeSelect = document.getElementById('type');

      function addInteractions() {
        draw = new ol.interaction.Draw({
          source: source,
          type: typeSelect.value
        });

		//FIXED CODE HERE!
		  draw.on('drawend',function(e){
			map.removeInteraction(draw);
			fill(e.feature)
		  }, this)
        map.addInteraction(draw);
        snap = new ol.interaction.Snap({source: source});
		map.addInteraction(snap);

      }

	  function fill(feature) {
		var format = new ol.format.WKT()
		 wkt = format.writeGeometry(feature.getGeometry())
         $('#wktgeom').val(wkt);
	  }


      /**
       * Handle change event.
       */
      typeSelect.onchange = function() {
        map.removeInteraction(draw);
        map.removeInteraction(snap);
        addInteractions();
      };

      addInteractions();

      $('.dropdown-menu').click(function() {
         $('.dropdown-submenu')
          .transition('fade down')
        ;
      })

    </script>


</html>