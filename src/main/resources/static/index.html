<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>GisHub, Your </title>

    <link rel="stylesheet" type="text/css" href="semantic/dist/semantic.min.css">
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">
    <script
            src="https://code.jquery.com/jquery-3.1.1.min.js"
            integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
            crossorigin="anonymous"></script>
    <script src="semantic/dist/semantic.min.js"></script>
    <link rel="stylesheet" href="https://openlayers.org/en/v4.6.4/css/ol.css" type="text/css">
    <style>
      .map {
        height: 400px;
        width: 100%;
      }
    </style>
    <script src="https://openlayers.org/en/v4.6.4/build/ol.js" type="text/javascript"></script>
</head>

<body>
    <div class="ui equal width aligned padded grid">
        <div class="row">
            <div class="ten wide centered column main">
                <div class="container">
                    <div class="ui segment">
                        <h2 class="ui dividing header">
                            <div class="content">
                                Geo objecten
                                <div class="sub header">Wat is een geo object en hoe kan je hiermee werken?</div>
                            </div>
                        </h2>
                        <p>
                            Binnen de Geo wereld zijn verschillende objecten beschikbaar waarmee op een kaart getekend kan worden.
                            Hierbij maken we als eerste onderscheid tussen <b>Point, LineString en Polygon</b>
                        </p>
                    </div>
                    <div class="ui segment">
                        <div class="ui pointing secondary menu">
                            <a class="item active" data-tab="activity">Activity</a>
                            <a class="item" data-tab="content">Content</a>
                            <a class="item" data-tab="video">Video</a>
                            <a class="item" data-tab="sources">Sources</a>
                        </div>
                        <div class="content container">
                            <div class="ui tab active basic segment" data-tab="activity">
                                <h2 class="ui dividing header">
                                    <i class="code icon"></i>
                                    <div class="content">
                                        Activity: Hoe werken deze objecten
                                    </div>
                                </h2>
                                <div id="map" class="map"></div>
                                <div class="ui form">
                                    <div class="inline field">
                                        <label>Last name</label>
                                        <select id="type">
                                            <option value="Point">Point</option>
                                            <option value="LineString">LineString</option>
                                            <option value="Polygon">Polygon</option>
                                        </select>
                                    </div>
                                    <div class="inline field">
                                        <label>WKT of your object</label>
                                        <textarea id="wktgeom"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="ui tab basic segment" data-tab="content">
                                <h2 class="ui dividing header">
                                    <i class="book icon"></i>
                                    <div class="content">
                                        Content: Welke objecten zijn er?
                                    </div>
                                </h2>
                            </div>
                            <div class="ui tab basic segment" data-tab="video">
                                <h2 class="ui dividing header">
                                    <i class="film icon"></i>
                                    <div class="content">
                                        Video: Video course
                                    </div>
                                </h2>
                            </div>
                            <div class="ui tab basic segment" data-tab="sources">
                                <h2 class="ui dividing header">
                                    <i class="sitemap icon"></i>
                                    <div class="content">
                                        Sources: Welke bronnen hebben we gebruikt?
                                    </div>
                                </h2>
                                <div class="ui relaxed divided list">
                                    <div class="item">
                                        <i class="large archive middle aligned icon"></i>
                                        <div class="content">
                                            <a class="header">https://openlayers.org/</a>
                                            <div class="description">Openlayers voor kaart.</div>
                                        </div>
                                    </div>
                                    <div class="item">
                                        <i class="large archive middle aligned icon"></i>
                                        <div class="content">
                                            <a class="header">Semantic-Org/Semantic-UI-Docs</a>
                                            <div class="description">Updated 22 mins ago</div>
                                        </div>
                                    </div>
                                    <div class="item">
                                        <i class="large archive middle aligned icon"></i>
                                        <div class="content">
                                            <a class="header">Semantic-Org/Semantic-UI-Meteor</a>
                                            <div class="description">Updated 34 mins ago</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="four wide column black menu">
                <h2 class="ui header">
                    <img src="assets/images/layers_icon-512.png">
                    <div class="content geo">
                        GisHub
                    </div>
                </h2>
                <div class="ui vertical inverted fluid accordion menu">
                    <div class="item">
                        <i class="bordered left check circle outline big green icon"></i>
                        <a class="active title">
                            <div class="header">
                                Geo objecten
                            </div>
                            <div class="description">Welke geo objecten zijn er?</div>
                        </a>
                        <div class="active content">
                            <div class="ui ordered list">
                                <a class="item" href="index.html">Punten, lijnen en polygonen</a>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <i class="bordered left circle outline big white icon"></i>
                        <a class="title">
                            <div class="header">
                                Geo formaten
                            </div>
                            <div class="description">Welke geo formaten zijn er?</div>
                        </a>
                        <div class="content">
                            <div class="ui ordered list">
                                <a class="item">GML</a>
                                <a class="item">WKT</a>
                                <a class="item">Shape</a>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <i class="bordered left circle outline big white icon"></i>
                        <a class="title">
                            <div class="header">
                                Geo webservices
                            </div>
                            <div class="description">Welke geo webservices zijn er?</div>
                        </a>
                        <div class="content">
                            <div class="ui ordered list">
                                <a class="item" href="geowebservices.html">WMS</a>
                                <a class="item">WMTS</a>
                                <a class="item">TMS</a>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <i class="bordered left circle outline big white icon"></i>
                        <a class="title">
                            <div class="header">
                                Geo Tools
                            </div>
                            <div class="description">Welke geo tools zijn er?</div>
                        </a>
                        <div class="content">
                            <div class="ui ordered list">
                                <a class="item">QGIS</a>
                                <a class="item">Geoserver</a>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <i class="bordered left circle outline big white icon"></i>
                        <a class="title">
                            <div class="header">
                                Geo Tiles
                            </div>
                            <div class="description">Hoe om te gaan met tiles?</div>
                        </a>
                        <div class="content">
                            <div class="ui ordered list">
                                <a class="item">Hoe worden tiles berekend?</a>
                            </div>
                        </div>
                    </div>
                </div>


                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
      var raster = new ol.layer.Tile({
        source: new ol.source.OSM()
      });

      var source = new ol.source.Vector();
      var vector = new ol.layer.Vector({
        source: source,
        style: new ol.style.Style({
          fill: new ol.style.Fill({
            color: 'rgba(255, 255, 255, 0.2)'
          }),
          stroke: new ol.style.Stroke({
            color: '#ffcc33',
            width: 2
          }),
          image: new ol.style.Circle({
            radius: 7,
            fill: new ol.style.Fill({
              color: '#ffcc33'
            })
          })
        })
      });

      var map = new ol.Map({
        layers: [raster, vector],
        target: 'map',
        view: new ol.View({
          center: [1000000, 7200000],
          zoom: 4
        })
      });

	  var modifiedFeatures= new Array()
      var modify = new ol.interaction.Modify({source: source});
      map.addInteraction(modify);

	  modify.on('modifyend', function(e){
	   var features = e.features.getArray();
		console.log(features.length);
		for (var i = 0; i < features.length; i++) {
			var rev = features[i].getRevision();
			if (rev > 1) {
				console.log("feature with revision:" + rev + " has been modified");
				modifiedFeatures.push(features[i]);
			}
		}
		fill(modifiedFeatures[0])
		modifiedFeatures = new Array()
	  })

      var draw, snap; // global so we can remove them later
      var typeSelect = document.getElementById('type');

      function addInteractions() {
        draw = new ol.interaction.Draw({
          source: source,
          type: typeSelect.value
        });

		//FIXED CODE HERE!
		  draw.on('drawend',function(e){
			map.removeInteraction(draw);
			fill(e.feature)
		  }, this)
        map.addInteraction(draw);
        snap = new ol.interaction.Snap({source: source});
		map.addInteraction(snap);

      }

	  function fill(feature) {
		var format = new ol.format.WKT()
		 wkt = format.writeGeometry(feature.getGeometry())
         $('#wktgeom').val(wkt);
	  }


      /**
       * Handle change event.
       */
      typeSelect.onchange = function() {
        map.removeInteraction(draw);
        map.removeInteraction(snap);
        addInteractions();
      };

      addInteractions();

      $('.dropdown-menu').click(function() {
         $('.dropdown-submenu')
          .transition('fade down')
        ;
      })

      $('.menu .item')
          .tab()
        ;

      $('.ui.accordion')
          .accordion()
        ;

    </script>


</html>